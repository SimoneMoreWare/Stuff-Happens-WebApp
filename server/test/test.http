### API Tests for Stuff Happens Game
### Base URL
@baseUrl = http://localhost:3001

### Variables
@username = user1
@password = password

### ===== AUTHENTICATION TESTS =====

### 1. Login (Create Session)
POST {{baseUrl}}/api/sessions
Content-Type: application/json

{
  "username": "{{username}}",
  "password": "{{password}}"
}

### 2. Get Current Session (Check if logged in)
GET {{baseUrl}}/api/sessions/current

### 3. Login with wrong credentials
POST {{baseUrl}}/api/sessions
Content-Type: application/json

{
  "username": "wrong",
  "password": "wrong"
}

### 4. Logout (Delete Session)
DELETE {{baseUrl}}/api/sessions/current

### ===== DEMO GAME TESTS (Anonymous Users) =====

### 5. Start Demo Game (default theme)
POST {{baseUrl}}/api/demo/start
Content-Type: application/json

{
}

### 6. Start Demo Game with specific theme
POST {{baseUrl}}/api/demo/start
Content-Type: application/json

{
  "theme": "university_life"
}

### 7. Demo Guess - Correct position (update with real IDs from start response)
POST {{baseUrl}}/api/demo/guess
Content-Type: application/json

{
  "targetCardId": 1,
  "initialCardIds": [2, 3, 4],
  "position": 1,
  "timeElapsed": 15
}

### 8. Demo Guess - Wrong position
POST {{baseUrl}}/api/demo/guess
Content-Type: application/json

{
  "targetCardId": 1,
  "initialCardIds": [2, 3, 4],
  "position": 0,
  "timeElapsed": 10
}

### 9. Demo Guess - Time expired
POST {{baseUrl}}/api/demo/guess
Content-Type: application/json

{
  "targetCardId": 1,
  "initialCardIds": [2, 3, 4],
  "position": 1,
  "timeElapsed": 35
}

### ===== FULL GAME TESTS (Authenticated Users) =====
### NOTE: Login first with test #1

### 10. Create New Game (must be logged in)
POST {{baseUrl}}/api/games
Content-Type: application/json

{
  "theme": "university_life"
}

### 11. Get Current Active Game
GET {{baseUrl}}/api/games/current

### 12. Try to create another game (should fail - one active game limit)
POST {{baseUrl}}/api/games
Content-Type: application/json

{
  "theme": "university_life"
}

### 13. Start Next Round (use game ID from create response)
POST {{baseUrl}}/api/games/1/next-round

### 14. Submit Guess - Correct (update with real IDs)
POST {{baseUrl}}/api/games/1/guess
Content-Type: application/json

{
  "gameCardId": 1,
  "position": 2
}

### 15. Submit Guess - Wrong (update with real IDs)
POST {{baseUrl}}/api/games/1/guess
Content-Type: application/json

{
  "gameCardId": 2,
  "position": 0
}

### 16. Handle Timeout (update with real IDs)
POST {{baseUrl}}/api/games/1/timeout
Content-Type: application/json

{
  "gameCardId": 3
}

### 17. Get Game History
GET {{baseUrl}}/api/games/history

### 18. Abandon Game (use real game ID)
DELETE {{baseUrl}}/api/games/1

### ===== ERROR TESTS =====

### 19. Try to access protected route without login
GET {{baseUrl}}/api/games/current

### 20. Invalid validation - Demo start with wrong theme
POST {{baseUrl}}/api/demo/start
Content-Type: application/json

{
  "theme": "invalid_theme"
}

### 21. Invalid validation - Demo guess with invalid position
POST {{baseUrl}}/api/demo/guess
Content-Type: application/json

{
  "targetCardId": 1,
  "initialCardIds": [2, 3, 4],
  "position": 5,
  "timeElapsed": 10
}

### 22. Invalid validation - Create game with wrong theme
POST {{baseUrl}}/api/games
Content-Type: application/json

{
  "theme": "invalid_theme"
}

### 23. Try to guess on non-existent game
POST {{baseUrl}}/api/games/999/guess
Content-Type: application/json

{
  "gameCardId": 1,
  "position": 1
}

### 24. Try to access other user's game (if you have multiple users)
POST {{baseUrl}}/api/games/999/next-round

### ===== WORKFLOW TEST =====
### Complete game workflow (run in sequence after login)

### 25. WORKFLOW: Create game
POST {{baseUrl}}/api/games
Content-Type: application/json

{
  "theme": "university_life"
}

### 26. WORKFLOW: Start first round
POST {{baseUrl}}/api/games/1/next-round

### 27. WORKFLOW: Make first guess
POST {{baseUrl}}/api/games/1/guess
Content-Type: application/json

{
  "gameCardId": 1,
  "position": 1
}

### 28. WORKFLOW: Start second round
POST {{baseUrl}}/api/games/1/next-round

### 29. WORKFLOW: Check current game status
GET {{baseUrl}}/api/games/current

### 30. WORKFLOW: Check history (after completing a game)
GET {{baseUrl}}/api/games/history